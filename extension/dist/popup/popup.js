(()=>{"use strict";const e={enabled:!0,filters:["email","phone","ssn","credit_card","api_key"],policies:[]};function t(){return new Promise(t=>{chrome.storage.local.get(e,e=>{t(e)})})}function n(e){return new Promise(t=>{chrome.storage.local.set(e,t)})}const s={email:"Email Addresses",phone:"Phone Numbers",ssn:"SSNs",credit_card:"Credit Cards",api_key:"API Keys"};function c(e){return e?`Last synced: ${new Date(e).toLocaleString()}`:"Never synced"}!async function(){const e=await t(),o=document.getElementById("enabledToggle");o.checked=e.enabled,o.addEventListener("change",()=>{n({enabled:o.checked})});const a=document.getElementById("filterList");for(const[c,o]of Object.entries(s)){const s=document.createElement("label");s.className="filter-item";const i=document.createElement("input");i.type="checkbox",i.checked=e.filters.includes(c),i.addEventListener("change",async()=>{const e=await t();n({filters:i.checked?[...new Set([...e.filters,c])]:e.filters.filter(e=>e!==c)})});const l=document.createElement("span");l.className="filter-name",l.textContent=o,s.appendChild(i),s.appendChild(l),a.appendChild(s)}const i=document.getElementById("policyCount"),l=e.policies.filter(e=>e.enabled).length,r=e.policies.length;i.innerHTML=0===r?"No policies configured.":`<strong>${l}</strong> of <strong>${r}</strong> policies active.`;const d=document.getElementById("lastSynced"),g=document.getElementById("syncBtn"),m=document.getElementById("syncMsg"),y=await chrome.storage.local.get("lastSyncedAt");d.textContent=c(y.lastSyncedAt),g.addEventListener("click",async()=>{g.disabled=!0,g.textContent="Syncingâ€¦",m.textContent="",m.className="sync-msg";try{const e=await chrome.runtime.sendMessage({type:"SYNC_NOW"});if(e?.ok){const e=await chrome.storage.local.get("lastSyncedAt");d.textContent=c(e.lastSyncedAt);const n=await t(),s=n.policies.filter(e=>e.enabled).length,o=n.policies.length;i.innerHTML=0===o?"No policies configured.":`<strong>${s}</strong> of <strong>${o}</strong> policies active.`,m.textContent="Sync successful!",m.classList.add("sync-msg--success")}else m.textContent="Sync failed. Is the webapp running?",m.classList.add("sync-msg--error")}catch{m.textContent="Sync failed. Background worker unreachable.",m.classList.add("sync-msg--error")}finally{g.disabled=!1,g.textContent="Sync Now"}})}()})();