(()=>{"use strict";const e={enabled:!0,filters:["email","phone","ssn","credit_card","api_key"],policies:[]},t="https://promptguard-p4.vercel.app",o="sync-policies";async function a(){try{const e=await fetch(`${t}/api/policies`,{credentials:"include"});if(e.ok){const t=await e.json();return void(Array.isArray(t.policies)&&await chrome.storage.local.set({policies:t.policies,lastSyncedAt:(new Date).toISOString()}))}if(401===e.status){const e=await fetch(`${t}/api/policies/sample`);if(e.ok){const t=await e.json();if(Array.isArray(t.policies))return await chrome.storage.local.set({policies:t.policies,lastSyncedAt:(new Date).toISOString()}),void console.info("[PromptGuard] Loaded sample policies (not logged in)")}}throw new Error(`HTTP ${e.status}`)}catch(e){throw console.error("[PromptGuard] Policy sync failed:",e),e}}chrome.runtime.onInstalled.addListener(async({reason:t})=>{if("install"===t){const t=await chrome.storage.local.get(Object.keys(e)),o={};for(const[a,i]of Object.entries(e))a in t||(o[a]=i);Object.keys(o).length>0&&await chrome.storage.local.set(o)}chrome.alarms.create(o,{periodInMinutes:30})}),chrome.alarms.onAlarm.addListener(e=>{e.name===o&&a()}),chrome.runtime.onMessage.addListener((e,t,o)=>{if("SYNC_NOW"===e.type)return a().then(()=>o({ok:!0})).catch(()=>o({ok:!1})),!0})})();