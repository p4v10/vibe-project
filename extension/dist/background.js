(()=>{"use strict";const e={enabled:!0,filters:["email","phone","ssn","credit_card","api_key"],policies:[]},t="sync-policies";async function a(){try{const e=await fetch("http://localhost:3000/api/policies",{credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();Array.isArray(t.policies)&&await chrome.storage.local.set({policies:t.policies,lastSyncedAt:(new Date).toISOString()})}catch(e){throw console.error("[PromptGuard] Policy sync failed:",e),e}}chrome.runtime.onInstalled.addListener(async({reason:a})=>{if("install"===a){const t=await chrome.storage.local.get(Object.keys(e)),a={};for(const[o,s]of Object.entries(e))o in t||(a[o]=s);Object.keys(a).length>0&&await chrome.storage.local.set(a)}chrome.alarms.create(t,{periodInMinutes:30})}),chrome.alarms.onAlarm.addListener(e=>{e.name===t&&a()}),chrome.runtime.onMessage.addListener((e,t,o)=>{if("SYNC_NOW"===e.type)return a().then(()=>o({ok:!0})).catch(()=>o({ok:!1})),!0})})();